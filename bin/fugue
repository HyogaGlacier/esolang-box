#!/bin/bash

infile=$(realpath "$@")
ln -sf "$infile" /tmp/code.mid
cd /tmp && ~/interpreters/fugue code.mid /coffc > /dev/null
sed -i -e "s/__cdecl //" /tmp/code_wrp.c
sed -i -e "s/fugue/_fugue/" /tmp/code_wrp.c
gcc /tmp/code.obj /tmp/code_wrp.c -o /tmp/code -m32
cat - | /tmp/code
rm /tmp/code.mid /tmp/code.obj /tmp/code_wrp.c /tmp/code
